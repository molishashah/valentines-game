<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Your Way To My Heart üíï</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #1a0a10;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Press Start 2P', cursive;
            overflow: hidden;
        }
        #gameContainer {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        canvas {
            border: 4px solid #FF69B4;
            box-shadow: 0 0 20px #FF69B4, 0 0 40px #FF69B4, inset 0 0 20px rgba(255, 105, 180, 0.3);
            border-radius: 8px;
        }
        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            pointer-events: none;
        }
        #titleScreen, #cardScreen, #celebrationScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(26, 10, 16, 0.95);
        }
        .hidden { display: none !important; }
        h1 {
            color: #FF69B4;
            font-size: 18px;
            text-align: center;
            text-shadow: 0 0 10px #FF69B4, 0 0 20px #FF69B4;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        h2 {
            color: #FFF5E1;
            font-size: 14px;
            margin-bottom: 40px;
        }
        .startBtn {
            background: linear-gradient(180deg, #FF69B4 0%, #FF1493 100%);
            color: #FFF5E1;
            border: none;
            padding: 15px 40px;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            cursor: pointer;
            pointer-events: auto;
            border-radius: 8px;
            box-shadow: 0 0 15px #FF69B4, 0 0 30px rgba(255, 105, 180, 0.5);
            transition: all 0.3s ease;
        }
        .startBtn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px #FF69B4, 0 0 50px rgba(255, 105, 180, 0.8);
        }
        #roseMessage {
            position: absolute;
            background: linear-gradient(135deg, #FF69B4, #FF1493);
            color: #FFF5E1;
            padding: 12px 20px;
            border-radius: 20px;
            font-size: 10px;
            text-align: center;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.8);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 100;
        }
        #roseCounter {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #FF69B4;
            font-size: 10px;
            text-shadow: 0 0 10px #FF69B4;
        }
        .floatingHeart {
            position: absolute;
            color: #FF69B4;
            opacity: 0.6;
            animation: float 4s ease-in-out infinite;
            pointer-events: none;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        /* Valentine Card Styles */
        #cardScreen {
            background: radial-gradient(ellipse at center, #2a1020 0%, #1a0a10 100%);
        }
        .card-container {
            background: linear-gradient(135deg, #2a1525 0%, #1a0a10 100%);
            border: 4px solid #FF69B4;
            border-radius: 20px;
            padding: 40px 60px;
            box-shadow: 0 0 30px #FF69B4, 0 0 60px rgba(255, 105, 180, 0.5), inset 0 0 30px rgba(255, 105, 180, 0.1);
            text-align: center;
            position: relative;
            z-index: 10;
        }
        .card-title {
            color: #FF69B4;
            font-size: 16px;
            text-shadow: 0 0 10px #FF69B4, 0 0 20px #FF69B4, 0 0 30px #FF69B4;
            margin-bottom: 10px;
            line-height: 1.8;
        }
        .card-question {
            color: #FFF5E1;
            font-size: 14px;
            margin-bottom: 40px;
            text-shadow: 0 0 10px rgba(255, 245, 225, 0.5);
        }
        .button-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            min-height: 60px;
        }
        .yes-btn {
            background: linear-gradient(180deg, #FF69B4 0%, #FF1493 100%);
            color: #FFF5E1;
            border: none;
            padding: 20px 50px;
            font-family: 'Press Start 2P', cursive;
            font-size: 14px;
            cursor: pointer;
            pointer-events: auto;
            border-radius: 12px;
            box-shadow: 0 0 20px #FF69B4, 0 0 40px rgba(255, 105, 180, 0.6);
            transition: all 0.3s ease;
            animation: sparkle 2s ease-in-out infinite;
        }
        .yes-btn:hover {
            transform: scale(1.15);
            box-shadow: 0 0 30px #FF69B4, 0 0 60px rgba(255, 105, 180, 0.9);
        }
        @keyframes sparkle {
            0%, 100% { box-shadow: 0 0 20px #FF69B4, 0 0 40px rgba(255, 105, 180, 0.6); }
            50% { box-shadow: 0 0 30px #FFB6C1, 0 0 60px rgba(255, 182, 193, 0.8), 0 0 80px rgba(255, 105, 180, 0.4); }
        }
        .no-btn {
            background: #444;
            color: #888;
            border: none;
            padding: 10px 20px;
            font-family: 'Press Start 2P', cursive;
            font-size: 8px;
            cursor: pointer;
            pointer-events: auto;
            border-radius: 6px;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: absolute;
        }
        .no-btn:hover {
            background: #555;
        }
        .no-btn.escaping {
            animation: wobble 0.3s ease;
        }
        @keyframes wobble {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-15deg); }
            75% { transform: rotate(15deg); }
        }
        .escape-message {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            color: #FFB6C1;
            font-size: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
            white-space: nowrap;
        }
        .escape-message.visible {
            opacity: 1;
        }
        .poof {
            position: absolute;
            pointer-events: none;
            animation: poofAnim 0.5s ease-out forwards;
        }
        @keyframes poofAnim {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }

        /* Celebration Screen */
        #celebrationScreen {
            background: radial-gradient(ellipse at center, #2a1020 0%, #1a0a10 100%);
        }
        .celebration-title {
            color: #FF69B4;
            font-size: 20px;
            text-shadow: 0 0 15px #FF69B4, 0 0 30px #FF69B4, 0 0 45px #FF69B4;
            margin-bottom: 20px;
            line-height: 1.8;
            animation: pulse 1.5s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); text-shadow: 0 0 15px #FF69B4, 0 0 30px #FF69B4; }
            50% { transform: scale(1.05); text-shadow: 0 0 25px #FFB6C1, 0 0 50px #FF69B4, 0 0 75px #FF69B4; }
        }
        .celebration-subtitle {
            color: #FFF5E1;
            font-size: 12px;
            margin-bottom: 40px;
            text-shadow: 0 0 10px rgba(255, 245, 225, 0.5);
        }
        .confetti {
            position: absolute;
            pointer-events: none;
        }
        .heart-float {
            position: absolute;
            animation: floatUp 4s ease-out forwards;
            pointer-events: none;
            font-size: 24px;
        }
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) rotate(0deg); }
            100% { opacity: 0; transform: translateY(-300px) rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="600" height="600"></canvas>
        <div id="roseCounter"></div>
        <div id="roseMessage"></div>
        <div id="titleScreen">
            <h1>Find Your Way<br>To My Heart</h1>
            <h2>‚ú® Janak ‚ú®</h2>
            <button class="startBtn" onclick="startGame()">START</button>
        </div>
        <div id="cardScreen" class="hidden">
            <div class="card-container">
                <h1 class="card-title">üíï Will You Be My üíï</h1>
                <h2 class="card-question">Valentine?</h2>
                <div class="button-container">
                    <button class="yes-btn" onclick="sayYes()">‚ú® YES ‚ú®</button>
                    <button class="no-btn" id="noBtn">no</button>
                </div>
                <div class="escape-message" id="escapeMessage"></div>
            </div>
        </div>
        <div id="celebrationScreen" class="hidden">
            <div id="confettiContainer"></div>
            <h1 class="celebration-title">üíï I Love You<br>Janak! üíï</h1>
            <h2 class="celebration-subtitle">Forever & Always ‚ú®</h2>
            <button class="startBtn" onclick="restartGame()">Play Again</button>
        </div>
    </div>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const TILE_SIZE = 24;
const GRID_W = 25;
const GRID_H = 25;

// Game state
let gameState = 'title';
let player = { x: 1, y: 1, dir: 'down', frame: 0, moving: false, targetX: 1, targetY: 1 };
let roses = [];
let rosesCollected = 0;
let goalPos = { x: 23, y: 23 };
let animationFrame = 0;
let lastTime = 0;
let keys = {};

// Rose messages
const roseMessages = [
    "You make me smile üíï", "My favorite person ‚ú®", "You're so cute! ü•∞",
    "I'm lucky to have you üíñ", "You light up my world üåü", "Forever yours üíù",
    "My heart is yours üíó", "You're amazing, Janak! üíï", "I love your laugh üòä",
    "Best boyfriend ever! üíñ"
];

// Maze layout (1 = wall, 0 = path, 2 = rose, 3 = goal)
const mazeTemplate = [
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
    [1,0,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,0,1],
    [1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],
    [1,0,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,0,1],
    [1,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1],
    [1,1,1,1,1,0,1,1,1,0,1,0,1,0,1,0,1,1,1,0,1,1,1,1,1],
    [1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],
    [1,0,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,0,1],
    [1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1],
    [1,1,1,0,1,0,1,1,1,1,1,0,1,0,1,1,1,1,1,0,1,0,1,1,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,1,1,0,1,0,1,1,1,1,1,0,1,0,1,1,1,1,1,0,1,0,1,1,1],
    [1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1],
    [1,0,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,0,1],
    [1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],
    [1,1,1,1,1,0,1,1,1,0,1,0,1,0,1,0,1,1,1,0,1,1,1,1,1],
    [1,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1],
    [1,0,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,0,1],
    [1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],
    [1,0,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,0,1],
    [1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

let maze = [];

// Rose positions in the maze
const rosePositions = [
    {x: 3, y: 3}, {x: 11, y: 5}, {x: 21, y: 3}, {x: 5, y: 11},
    {x: 19, y: 11}, {x: 3, y: 19}, {x: 11, y: 17}, {x: 21, y: 19},
    {x: 9, y: 9}, {x: 15, y: 15}
];

function initMaze() {
    maze = mazeTemplate.map(row => [...row]);
    roses = rosePositions.map((pos, i) => ({ ...pos, collected: false, id: i }));
    player = { x: 1, y: 1, dir: 'down', frame: 0, moving: false, targetX: 1, targetY: 1 };
    rosesCollected = 0;
    updateRoseCounter();
}

function updateRoseCounter() {
    document.getElementById('roseCounter').textContent = `üåπ ${rosesCollected}/${roses.length}`;
}

// Draw neon glowing wall tile
function drawWall(x, y) {
    const px = x * TILE_SIZE;
    const py = y * TILE_SIZE;

    // Outer glow
    ctx.shadowColor = '#FF69B4';
    ctx.shadowBlur = 15;
    ctx.fillStyle = '#FF69B4';
    ctx.fillRect(px + 2, py + 2, TILE_SIZE - 4, TILE_SIZE - 4);

    // Inner highlight
    ctx.shadowBlur = 0;
    ctx.fillStyle = '#FFB6C1';
    ctx.fillRect(px + 4, py + 4, TILE_SIZE - 8, TILE_SIZE - 8);

    // Core
    ctx.fillStyle = '#FF69B4';
    ctx.fillRect(px + 6, py + 6, TILE_SIZE - 12, TILE_SIZE - 12);
}

// Draw pixel rose
function drawRose(x, y) {
    const px = x * TILE_SIZE + TILE_SIZE / 2;
    const py = y * TILE_SIZE + TILE_SIZE / 2;
    const pulse = Math.sin(animationFrame * 0.1) * 2;

    ctx.shadowColor = '#FF4D6D';
    ctx.shadowBlur = 10 + pulse;

    // Petals
    ctx.fillStyle = '#FF4D6D';
    ctx.beginPath();
    ctx.arc(px, py - 2, 6, 0, Math.PI * 2);
    ctx.fill();
    ctx.beginPath();
    ctx.arc(px - 4, py + 2, 5, 0, Math.PI * 2);
    ctx.fill();
    ctx.beginPath();
    ctx.arc(px + 4, py + 2, 5, 0, Math.PI * 2);
    ctx.fill();

    // Stem
    ctx.shadowBlur = 0;
    ctx.fillStyle = '#228B22';
    ctx.fillRect(px - 1, py + 5, 2, 6);
}

// Draw glowing goal heart
function drawGoalHeart(x, y) {
    const px = x * TILE_SIZE + TILE_SIZE / 2;
    const py = y * TILE_SIZE + TILE_SIZE / 2;
    const pulse = Math.sin(animationFrame * 0.15) * 3;

    ctx.shadowColor = '#FF1744';
    ctx.shadowBlur = 20 + pulse;
    ctx.fillStyle = '#FF1744';

    ctx.beginPath();
    ctx.moveTo(px, py + 6);
    ctx.bezierCurveTo(px - 10, py - 5, px - 10, py - 10, px, py - 5);
    ctx.bezierCurveTo(px + 10, py - 10, px + 10, py - 5, px, py + 6);
    ctx.fill();

    ctx.shadowBlur = 0;
}

// Draw Janak character (16x20 pixel sprite)
function drawJanak(x, y, dir, frame) {
    const px = x * TILE_SIZE + 4;
    const py = y * TILE_SIZE + 2;
    const p = 1; // pixel size

    ctx.shadowBlur = 0;

    // Colors
    const skin = '#C68642';  // Medium brown skin
    const hair = '#1a1a1a'; // Black fluffy hair
    const hoodie = '#2a2a2a'; // Black hoodie
    const jeans = '#1f1f1f'; // Black jeans

    // Draw based on direction
    // Hair (fluffy curly - top of head)
    ctx.fillStyle = hair;
    if (dir === 'up') {
        // Back of head - more hair visible
        for (let i = 2; i < 14; i++) {
            ctx.fillRect(px + i * p, py, p, p * 3);
        }
        ctx.fillRect(px + 3 * p, py + p, p * 10, p * 4);
    } else {
        // Front/side views - curly hair
        ctx.fillRect(px + 3 * p, py, p * 10, p * 2);
        ctx.fillRect(px + 2 * p, py + p, p * 12, p * 2);
        ctx.fillRect(px + 2 * p, py + 3 * p, p * 2, p * 2);
        ctx.fillRect(px + 12 * p, py + 3 * p, p * 2, p * 2);
        // Curly bits
        ctx.fillRect(px + p, py + 2 * p, p * 2, p);
        ctx.fillRect(px + 13 * p, py + 2 * p, p * 2, p);
    }

    // Face
    ctx.fillStyle = skin;
    if (dir === 'up') {
        ctx.fillRect(px + 4 * p, py + 5 * p, p * 8, p * 3);
    } else {
        ctx.fillRect(px + 4 * p, py + 4 * p, p * 8, p * 4);
        // Eyes (not visible from back)
        ctx.fillStyle = '#1a1a1a';
        ctx.fillRect(px + 5 * p, py + 5 * p, p * 2, p * 2);
        ctx.fillRect(px + 9 * p, py + 5 * p, p * 2, p * 2);
    }

    // Hoodie body
    ctx.fillStyle = hoodie;
    ctx.fillRect(px + 3 * p, py + 8 * p, p * 10, p * 7);
    // Hood outline
    ctx.fillRect(px + 2 * p, py + 8 * p, p, p * 3);
    ctx.fillRect(px + 13 * p, py + 8 * p, p, p * 3);

    // Arms
    const armOffset = frame % 2 === 0 ? 0 : p;
    if (dir === 'left') {
        ctx.fillRect(px + 2 * p, py + 9 * p - armOffset, p * 2, p * 4);
        ctx.fillRect(px + 12 * p, py + 9 * p + armOffset, p * 2, p * 4);
    } else if (dir === 'right') {
        ctx.fillRect(px + 2 * p, py + 9 * p + armOffset, p * 2, p * 4);
        ctx.fillRect(px + 12 * p, py + 9 * p - armOffset, p * 2, p * 4);
    } else {
        ctx.fillRect(px + 2 * p, py + 9 * p, p * 2, p * 4);
        ctx.fillRect(px + 12 * p, py + 9 * p, p * 2, p * 4);
    }

    // Jeans
    ctx.fillStyle = jeans;
    ctx.fillRect(px + 4 * p, py + 15 * p, p * 3, p * 5);
    ctx.fillRect(px + 9 * p, py + 15 * p, p * 3, p * 5);

    // Walking animation - leg movement
    if (player.moving && frame % 2 === 1) {
        if (dir === 'left' || dir === 'right') {
            ctx.fillRect(px + 4 * p, py + 15 * p, p * 3, p * 4);
            ctx.fillRect(px + 9 * p, py + 16 * p, p * 3, p * 4);
        } else if (dir === 'up' || dir === 'down') {
            ctx.fillRect(px + 5 * p, py + 15 * p, p * 2, p * 5);
            ctx.fillRect(px + 9 * p, py + 15 * p, p * 2, p * 5);
        }
    }

    // Shoes
    ctx.fillStyle = '#111';
    ctx.fillRect(px + 3 * p, py + 19 * p, p * 4, p);
    ctx.fillRect(px + 9 * p, py + 19 * p, p * 4, p);
}

// Show rose message popup
function showRoseMessage(index) {
    const msgEl = document.getElementById('roseMessage');
    msgEl.textContent = roseMessages[index % roseMessages.length];
    msgEl.style.opacity = '1';
    msgEl.style.top = '50%';
    msgEl.style.left = '50%';
    msgEl.style.transform = 'translate(-50%, -50%)';

    setTimeout(() => {
        msgEl.style.opacity = '0';
    }, 2000);
}

// Handle input
function handleInput() {
    if (!player.moving && gameState === 'playing') {
        let newX = player.x;
        let newY = player.y;
        let newDir = player.dir;

        if (keys['ArrowUp'] || keys['KeyW']) { newY--; newDir = 'up'; }
        else if (keys['ArrowDown'] || keys['KeyS']) { newY++; newDir = 'down'; }
        else if (keys['ArrowLeft'] || keys['KeyA']) { newX--; newDir = 'left'; }
        else if (keys['ArrowRight'] || keys['KeyD']) { newX++; newDir = 'right'; }

        player.dir = newDir;

        // Check if can move
        if (newX >= 0 && newX < GRID_W && newY >= 0 && newY < GRID_H && maze[newY][newX] !== 1) {
            player.targetX = newX;
            player.targetY = newY;
            player.moving = true;
        }
    }
}

// Update game state
function update() {
    if (gameState !== 'playing') return;

    // Smooth movement
    if (player.moving) {
        const speed = 0.15;
        const dx = player.targetX - player.x;
        const dy = player.targetY - player.y;

        if (Math.abs(dx) > 0.05) player.x += dx * speed;
        else player.x = player.targetX;

        if (Math.abs(dy) > 0.05) player.y += dy * speed;
        else player.y = player.targetY;

        if (player.x === player.targetX && player.y === player.targetY) {
            player.moving = false;
            player.frame = (player.frame + 1) % 2;

            // Check rose collection
            const gridX = Math.round(player.x);
            const gridY = Math.round(player.y);
            roses.forEach((rose, i) => {
                if (!rose.collected && rose.x === gridX && rose.y === gridY) {
                    rose.collected = true;
                    rosesCollected++;
                    updateRoseCounter();
                    showRoseMessage(rosesCollected - 1);
                }
            });

            // Check goal
            if (gridX === goalPos.x && gridY === goalPos.y) {
                gameState = 'card';
                document.getElementById('cardScreen').classList.remove('hidden');
            }
        }
    }

    handleInput();
}

// Draw everything
function draw() {
    // Clear with dark background
    ctx.fillStyle = '#1a0a10';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    if (gameState === 'title') return;

    // Draw maze
    for (let y = 0; y < GRID_H; y++) {
        for (let x = 0; x < GRID_W; x++) {
            if (maze[y][x] === 1) {
                drawWall(x, y);
            }
        }
    }

    // Draw roses
    roses.forEach(rose => {
        if (!rose.collected) {
            drawRose(rose.x, rose.y);
        }
    });

    // Draw goal heart
    drawGoalHeart(goalPos.x, goalPos.y);

    // Draw player
    drawJanak(player.x, player.y, player.dir, player.frame);
}

// Main game loop
function gameLoop(timestamp) {
    const deltaTime = timestamp - lastTime;
    lastTime = timestamp;

    animationFrame++;

    update();
    draw();

    requestAnimationFrame(gameLoop);
}

// Game control functions
function startGame() {
    document.getElementById('titleScreen').classList.add('hidden');
    initMaze();
    gameState = 'playing';
}

function showCelebration() {
    document.getElementById('cardScreen').classList.add('hidden');
    document.getElementById('celebrationScreen').classList.remove('hidden');
    gameState = 'celebration';
    launchConfetti();
    createCelebrationHearts();
}

function restartGame() {
    document.getElementById('celebrationScreen').classList.add('hidden');
    document.getElementById('titleScreen').classList.remove('hidden');
    gameState = 'title';
    escapeCount = 0;
    resetNoButton();
}

// ==========================================
// ESCAPING NO BUTTON LOGIC
// ==========================================

let escapeCount = 0;
let noButtonVisible = true;
const ESCAPE_DISTANCE = 80; // Pixels - detect when mouse is close

function initEscapingButton() {
    const noBtn = document.getElementById('noBtn');
    const cardScreen = document.getElementById('cardScreen');

    // Position the no button initially
    resetNoButton();

    // Track mouse movement on card screen
    cardScreen.addEventListener('mousemove', handleMouseProximity);

    // Also handle touch for mobile
    cardScreen.addEventListener('touchmove', (e) => {
        const touch = e.touches[0];
        handleMouseProximity({ clientX: touch.clientX, clientY: touch.clientY });
    });
}

function resetNoButton() {
    const noBtn = document.getElementById('noBtn');
    noBtn.style.right = '60px';
    noBtn.style.top = '50%';
    noBtn.style.transform = 'translateY(-50%)';
    noBtn.style.left = 'auto';
    noBtn.style.display = 'block';
    noBtn.style.fontSize = '8px';
    noBtn.style.padding = '10px 20px';
    noBtn.style.opacity = '1';
    noButtonVisible = true;
    document.getElementById('escapeMessage').classList.remove('visible');
}

function handleMouseProximity(e) {
    if (!noButtonVisible || gameState !== 'card') return;

    const noBtn = document.getElementById('noBtn');
    const rect = noBtn.getBoundingClientRect();
    const btnCenterX = rect.left + rect.width / 2;
    const btnCenterY = rect.top + rect.height / 2;

    const distance = Math.sqrt(
        Math.pow(e.clientX - btnCenterX, 2) +
        Math.pow(e.clientY - btnCenterY, 2)
    );

    if (distance < ESCAPE_DISTANCE) {
        escapeButton();
    }
}

function escapeButton() {
    const noBtn = document.getElementById('noBtn');
    const cardScreen = document.getElementById('cardScreen');
    const cardRect = cardScreen.getBoundingClientRect();

    escapeCount++;

    // Add wobble animation
    noBtn.classList.add('escaping');
    setTimeout(() => noBtn.classList.remove('escaping'), 300);

    // Progressive behavior
    updateEscapeMessage();

    // After 5 escapes: button gets smaller
    if (escapeCount >= 5) {
        const scale = Math.max(0.5, 1 - (escapeCount - 5) * 0.1);
        noBtn.style.fontSize = `${8 * scale}px`;
        noBtn.style.padding = `${10 * scale}px ${20 * scale}px`;
    }

    // After 10 escapes: button disappears with poof
    if (escapeCount >= 10) {
        createPoofEffect(noBtn);
        noBtn.style.display = 'none';
        noButtonVisible = false;
        return;
    }

    // Calculate new random position within bounds
    const padding = 60;
    const btnWidth = noBtn.offsetWidth;
    const btnHeight = noBtn.offsetHeight;

    const maxX = cardRect.width - btnWidth - padding;
    const maxY = cardRect.height - btnHeight - padding;

    const newX = padding + Math.random() * maxX;
    const newY = padding + Math.random() * maxY;

    // Apply new position with slight rotation
    const rotation = (Math.random() - 0.5) * 20;
    noBtn.style.left = `${newX}px`;
    noBtn.style.top = `${newY}px`;
    noBtn.style.right = 'auto';
    noBtn.style.transform = `rotate(${rotation}deg)`;
}

function updateEscapeMessage() {
    const msgEl = document.getElementById('escapeMessage');
    let message = '';

    if (escapeCount >= 7) {
        message = 'Please? üíï';
    } else if (escapeCount >= 5) {
        message = "I'm getting smaller! ü•∫";
    } else if (escapeCount >= 3) {
        message = 'Are you sure? ü•∫';
    }

    if (message) {
        msgEl.textContent = message;
        msgEl.classList.add('visible');
    }
}

function createPoofEffect(element) {
    const rect = element.getBoundingClientRect();
    const cardScreen = document.getElementById('cardScreen');

    // Create sparkle particles
    const particles = ['‚ú®', 'üí´', '‚≠ê', 'üíï', 'üíñ'];
    for (let i = 0; i < 8; i++) {
        const poof = document.createElement('div');
        poof.className = 'poof';
        poof.textContent = particles[Math.floor(Math.random() * particles.length)];
        poof.style.left = `${rect.left - cardScreen.getBoundingClientRect().left + rect.width/2}px`;
        poof.style.top = `${rect.top - cardScreen.getBoundingClientRect().top + rect.height/2}px`;
        poof.style.fontSize = `${12 + Math.random() * 10}px`;
        cardScreen.appendChild(poof);

        // Animate outward
        const angle = (i / 8) * Math.PI * 2;
        const distance = 30 + Math.random() * 20;
        poof.animate([
            { transform: 'translate(-50%, -50%) scale(1)', opacity: 1 },
            { transform: `translate(${Math.cos(angle) * distance - 50}%, ${Math.sin(angle) * distance - 50}%) scale(0)`, opacity: 0 }
        ], { duration: 500, easing: 'ease-out' });

        setTimeout(() => poof.remove(), 500);
    }

    // Show final message
    const msgEl = document.getElementById('escapeMessage');
    msgEl.textContent = "Fine, I'll just love you forever! üíï";
    msgEl.classList.add('visible');
}

// ==========================================
// YES BUTTON AND CELEBRATION
// ==========================================

function sayYes() {
    gameState = 'celebration';
    showCelebration();
}

function launchConfetti() {
    const container = document.getElementById('confettiContainer');
    container.innerHTML = '';

    const colors = ['#FF69B4', '#FFB6C1', '#FF1493', '#FF4D6D', '#FFF5E1', '#FF6B9D'];
    const shapes = ['‚ù§Ô∏è', 'üíï', 'üíñ', 'üíó', '‚ú®', 'üå∏'];

    // Create confetti particles
    for (let i = 0; i < 100; i++) {
        setTimeout(() => {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';

            // Randomly choose between shape emoji or colored square
            if (Math.random() > 0.5) {
                confetti.textContent = shapes[Math.floor(Math.random() * shapes.length)];
                confetti.style.fontSize = `${10 + Math.random() * 15}px`;
            } else {
                confetti.style.width = `${5 + Math.random() * 10}px`;
                confetti.style.height = `${5 + Math.random() * 10}px`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
            }

            confetti.style.left = `${Math.random() * 100}%`;
            confetti.style.top = '-20px';

            container.appendChild(confetti);

            // Animate falling
            const duration = 2000 + Math.random() * 2000;
            const endX = (Math.random() - 0.5) * 200;

            confetti.animate([
                { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                { transform: `translateY(${window.innerHeight + 50}px) translateX(${endX}px) rotate(${360 + Math.random() * 360}deg)`, opacity: 0.8 }
            ], { duration: duration, easing: 'ease-in' });

            setTimeout(() => confetti.remove(), duration);
        }, i * 30);
    }
}

function createCelebrationHearts() {
    const celebrationScreen = document.getElementById('celebrationScreen');

    // Create floating hearts
    for (let i = 0; i < 20; i++) {
        setTimeout(() => {
            const heart = document.createElement('div');
            heart.className = 'heart-float';
            heart.textContent = ['üíï', 'üíñ', 'üíó', '‚ù§Ô∏è', 'üíù'][Math.floor(Math.random() * 5)];
            heart.style.left = `${10 + Math.random() * 80}%`;
            heart.style.bottom = '0';
            heart.style.fontSize = `${20 + Math.random() * 20}px`;
            celebrationScreen.appendChild(heart);

            setTimeout(() => heart.remove(), 4000);
        }, i * 200);
    }
}

// Event listeners
document.addEventListener('keydown', (e) => {
    keys[e.code] = true;
    e.preventDefault();
});

document.addEventListener('keyup', (e) => {
    keys[e.code] = false;
});

// Create floating hearts for title screen
function createFloatingHearts() {
    const container = document.getElementById('titleScreen');
    for (let i = 0; i < 15; i++) {
        const heart = document.createElement('div');
        heart.className = 'floatingHeart';
        heart.textContent = 'üíï';
        heart.style.left = Math.random() * 100 + '%';
        heart.style.top = Math.random() * 100 + '%';
        heart.style.fontSize = (Math.random() * 20 + 10) + 'px';
        heart.style.animationDelay = (Math.random() * 4) + 's';
        container.appendChild(heart);
    }
}

// Create floating hearts for card screen
function createCardFloatingHearts() {
    const container = document.getElementById('cardScreen');
    for (let i = 0; i < 12; i++) {
        const heart = document.createElement('div');
        heart.className = 'floatingHeart';
        heart.textContent = ['üíï', 'üíñ', 'üíó', '‚ú®'][Math.floor(Math.random() * 4)];
        heart.style.left = Math.random() * 100 + '%';
        heart.style.top = Math.random() * 100 + '%';
        heart.style.fontSize = (Math.random() * 15 + 8) + 'px';
        heart.style.animationDelay = (Math.random() * 4) + 's';
        container.appendChild(heart);
    }
}

// Initialize
createFloatingHearts();
createCardFloatingHearts();
initEscapingButton();
requestAnimationFrame(gameLoop);
</script>
</body>
</html>

